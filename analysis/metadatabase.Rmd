---
title: "Meta-database: environmental and societal drivers of change in Arctic fjord ecosystems"
author: "Robert Schlegel"
date: '`r format(Sys.Date(), "%d %B %Y")`'
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
css: acid.css
csl: frontiers.csl
bibliography: FACE-IT.bib
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.align = 'center',
                      echo = FALSE, warning = FALSE, message = FALSE, 
                      eval = TRUE, tidy = FALSE)
```

<center>
![](assets/FACE-IT_Logo_900.png){ width=70% }
</center>

# Introduction

```{r setup}
# Necessary libraries
library(tidyverse) # The tidy dialect of R
library(tidync) # For reading NetCDF
library(DT) # For interactive tables
library(kableExtra) # For formatting static tables
# library(htmltools) # For additional HTML options
# library(bsplus) # For additional buttons
# library(ijtiff) # For reading the glacier tif files

# Table column names
DT_cols <- c("Name", "Date", "Longitude", "Latitude", "Depth", "File(s)", "Link", "Reference", "Note(s)")

# Datatable options for all tables
options(DT.options = list(pageLength = 5,
                          # autoWidth = TRUE,
                          # This chunk of code only allows six characters to be shown in a column
                          # But it interferes with the HTML code for popups and links
                          # columnDefs = list(list(
                          #   targets = list(9),
                          #   render = JS(
                          #     "function(data, type, row, meta) {",
                          #     "return type === 'display' && data.length > 6 ?",
                          #     "'<span title=\"' + data + '\">' + data.substr(0, 6) + '...</span>' : data;",
                          #     "}"))),
                          # columnDefs = list(list(width = '20%', targets = c(2))),
                          deferRender = TRUE,
                          # scrollX = TRUE,
                          scrollY = 400,
                          scrollCollapse = TRUE,
                          lengthMenu = c(5, 10, 25, 50, 100)))
```

```{r meta-data-func}
# Function for smoother meta-data creation
make_meta_data <- function(dat, data_name, file_name, URL, reference, note = NA){
  
  # Find longitude range
  lon_col <- c(colnames(dat)[str_detect(colnames(dat), "lon")],
               colnames(dat)[str_detect(colnames(dat), "Lon")])
  if(length(lon_col) > 0){
    lon_min <- round(min(dat[,lon_col], na.rm = T), 2)
    lon_max <- round(max(dat[,lon_col], na.rm = T), 2)
    lon_range <- paste0(lon_min," to ", lon_max)
  } else {
    lon_min <- NA; lon_max <- NA
    lon_range <- NA
  }
  
  # Find latitude range
  lat_col <- c(colnames(dat)[str_detect(colnames(dat), "lat")],
               colnames(dat)[str_detect(colnames(dat), "Lat")])
  if(length(lat_col) > 0){
    lat_min <- round(min(dat[,lat_col], na.rm = T), 2)
    lat_max <- round(max(dat[,lat_col], na.rm = T), 2)
    lat_range <- paste0(lat_min," to ", lat_max)
  } else {
    lat_min <- NA; lat_max <- NA
    lat_range <- NA
  }
  
  # Find depth range
  depth_col <- c(colnames(dat)[str_detect(colnames(dat), "depth")],
                 colnames(dat)[str_detect(colnames(dat), "Depth")])
  depth_col <- depth_col[!str_detect(depth_col, "bot")]
  depth_col <- depth_col[!str_detect(depth_col, "Bot")]
  if(length(depth_col) > 0){
    depth_min <- round(min(dat[,depth_col], na.rm = T), 2)
    depth_max <- round(max(dat[,depth_col], na.rm = T), 2)
    depth_range <- paste0(depth_min," to ", depth_max)
  } else {
    depth_min <- NA; depth_max <- NA
    depth_range <- NA
  }

  # Find depth range
  date_col <- c(colnames(dat)[str_detect(colnames(dat), "date")],
                colnames(dat)[str_detect(colnames(dat), "Date")])
  year_col <- c(colnames(dat)[str_detect(colnames(dat), "year")],
                colnames(dat)[str_detect(colnames(dat), "Year")])
  if(length(date_col) > 0){
    date_dat <- dat[,date_col] %>% `colnames<-`("t")
    if(!is.na(as.Date(date_dat$t[1], "%Y-%m-%d"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%Y-%m-%d")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%Y-%m-%d")), na.rm = T)
    } else if(!is.na(as.Date(date_dat$t[1], "%Y%m%d"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%Y%m%d")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%Y%m%d")), na.rm = T)
    }else if(!is.na(as.Date(date_dat$t[1], "%Y/%m/%d"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%Y/%m/%d")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%Y/%m/%d")), na.rm = T)
    } else if(!is.na(as.Date(date_dat$t[1], "%d/%m/%Y"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%d/%m/%Y")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%d/%m/%Y")), na.rm = T)
    } else if(!is.na(as.Date(date_dat$t[1], "%m/%d/%Y"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%m/%d/%Y")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%m/%d/%Y")), na.rm = T)
    } else {
      date_min <- NA; date_max <- NA
    }
  }
  if(is.na(depth_min) & length(year_col) > 0) {
    year_dat <- dat[,year_col] %>% `colnames<-`("year")
    date_min <- min(year_dat$year, na.rm = T)
    date_max <- max(year_dat$year, na.rm = T)
  }
  if(!is.na(date_min)){
    date_range <- paste0(date_min," to ", date_max)
  } else {
    date_range <- NA
  }
  
  # Determine ecoregions
  # Find point in MEOW polygons
  
  # Combine and output
  res <- data.frame(data_name, 
                    date_range, lon_range, lat_range, depth_range,
                    # date_min, date_max, lon_min, lon_max, lat_min, lat_max, depth_min, depth_max, 
                    file_name, URL, reference,
                    note)
  return(res)
}
```

This document is designed to satisfy D1.1 and eventually D1.2 for the Horizon2020 project [FACE-IT](https://www.face-it-project.eu/). The text and static tables in this document are a report on the key drivers of change in Arctic fjord biodiversity (D1.1). The interactive tables contain the meta-database for the data identified as key drivers of change (D1.2). The text and meta-data from this document will be used for the completion of a review article on past and future changes of key drivers in and around the FACE-IT study sites (D1.3). This document begins with a review of known drivers of change in the European Arctic before focussing in on each individual FACE-IT study site to discuss any differences from the broader Arctic. Each of the following sections for each region/study site contain tables that show a summary of their key drivers and meta-data. There is no central table for all of the drivers or meta-data.

# European Arctic

<center>
![](assets/map_full.png){ width=50% }
</center>

> The decline in the floating sea ice cover in the Arctic is one of the most striking manifestations of climate change.  
[@Stroeve2018]

Many physical processes are known to drive biodiversity in the Arctic. Unsurprisingly, the presence of sea ice is one of these controlling factors [@Pavlova2019]. The cryosphere, of which sea ice is a part, is one of the defining characteristics of the Arctic that sets it apart from neighbouring climatic regions (e.g. boreal and cold temperate). It is therefore safe to assume that changes to the Arctic cryosphere will lead to fundamental changes in the biodiversity found there. The cryosphere itself however is not the primary driver of change in the Arctic. This is because changes in the cryosphere are themselves being driven by the changes in temperature that are in turn driven by the primary driver of climatic change that defines the anthropocene: increases in CO2 emissions from human activities. It is this relatively rapid increase in temperature that is having a profound effect on the Arctic cryosphere [@Meredith2019], and there is a robust linear relationship between increases in atmospheric CO2 and deceases in sea ice extent [@Stroeve2018]. Therefore, as with almost any study of biodiversity, high-quality spatiotemporally complete temperature data are crucial. The longer the complete time series the better.

There are however many more important variables to consider, such as photosynthetically available radiation (PAR), ultraviolet radiation (UVR), and turbidity [@Hop2019]. Many of these important drivers are known from research conducted further south. Where datasets are easier to build, and time series are longer. For this reason one may find that the drivers of change in Arctic are more often inferred than they are 'known'. This is because historically there has been a paucity of data in the Arctic [@Bischof2019kongsfjorden]. Many international projects, in coordination with many established Arctic research institutions, have been very busy to close this knowledge gap and the holes in our knowledge are being filled rapidly. FACE-IT is one of these projects that seeks to better understand biodiversity changes, while contributing to and drawing from this expanding body of knowledge.

In addition to knowing what it is that may cause changes, it is necessary to identify the fonts of biodiversity that may be affected by these drivers. There are many taxa/species etc. that have been identified as important for monitoring throughout the Arctic. Foremost of these are the kelps, brown macroalgae that often function as ecosystem engineers along the cool temperate coastlines of the world or cooler [@Bischof2019kelps]. The prevailing hypothesis is that as the Arctic warms, the retreating coastal sea ice and increased temperatures will be more hospitable to kelp forests, and everything that comes with them. But there's a catch. As temperatures warm, glaciers melt more rapidly, releasing more runoff into coastal zones that increases turbidity [@Bischof2019kelps]. This means that benthic organisms, like kelps, will not receive the levels of PAR that they would like, potentially inhibiting their growth. One benefit of this is that the kelps are exposed to lower levels of UVR, which may help them to some extent. More research and longer time series are required to say conclusively how this situation will play out. It will also differ between sites and so this issue is addressed again below where appropriate.

Consider that even if global temperature rise is limited to 2°C, this will mean a +4°C increase in the Arctic [@Overland2019]. Land ice melt is also projected to continue regardless of emission reductions due to internal lags, meaning that continued sea level rise throughout the century is a certainty. One must also keep in mind that the disproportionately larger surface heat fluxes into the Arctic may inhibit the stabilisation of the global climate even if an effective emissions reduction strategy is implemented [@Overland2019].

_NB: This is one option for how to show tabular information. I've put the tables behind these buttons so that only one is shown at a time. Lower down in this document all tables are shown together. I'm curious to know what people prefer._

#### Tables {.tabset .tabset-fade .tabset-pills} 

##### Drivers {-}

```{r EU-arctic-table}
knitr::kable(data.frame(Category = c("Cryosphere", "Cryosphere", "Cryosphere",
                                     "Physical", "Physical", "Physical", "Physical"),
                        Driver = c("Sea-ice cover", "Glacial melt", "Permafrost thaw",
                                   "Air temperature", "SST", "Precipitation", "Freshwater runoff"),
                        Why = c("", "", "",
                                "", "", 
                                "Affects the amount of fresh water runoff into coasts.", 
                                "Delivers carbon and nutrient rich freshwater to coast."),
                        Reference = c("Stroeve and Notz (2018)", "", "", 
                                      "", "", "",
                                      "Delpech et al. (2021)"))) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "responsive")) %>% 
  row_spec(1:3, background = "mintcream") %>% 
  row_spec(4:7, color = "black", background = "skyblue")
```

##### Meta-data {-}

```{r EU-arctic-meta-data}
# Zooplankton biodiversity
EU_zooplankton <- read_tsv("~/pCloudDrive/FACE-IT_data/EU_arctic/1995-2008-zooplankton-biodiversity.tsv", guess_max = 100000) %>% 
  make_meta_data(data_name = 'Zooplankton biodiversity',
                 file_name = '<a onclick="alert(\'1995-2008-zooplankton-biodiversity.tsv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/9167dae8-cab2-45b3-9cea-ad69541b0448">NPDC</a>',
                 reference = '<a onclick="alert(\'Norwegian Polar Institute (2020). Marine zooplankton and icefauna biodiversity [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.9167dae8\');">NPI (2020)</a>')

# Ice modelling output
# EU_ice <- tidync() %>% 
#   make_meta_data(data_name = "Model: ice thickness + snow-ice + snow depth",
#                  file_name = '<a onclick="alert(\'HIGHTSI/\');">1 folder</a>',
#                  URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/881e423a-b6f6-4c1a-8000-d802adf03a66">NPDC</a>',
#                  reference = '<a onclick="alert(\'Liston, G., Merkouriadi, I., & Granskog, M. A. (2019). Snow-ice, snow depth and ice thickness from HIGHTSI modeling with ice motion in the Arctic Ocean in the period 1980 to 2016 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2019.881e423a\');">Liston et al. (2016)</a>')

# Combine
metadata_EU_arctic <- rbind(EU_zooplankton)
```

```{r EU-arctic-meta-data-table}
DT::datatable(metadata_EU_arctic, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              # filter = "top", 
              caption = "All files in this table are found within '~/pCloudDrive/FACE-IT_data/EU_arctic/'.")
```

# Svalbard

<center>
![](assets/map_svalbard.png){ width=50% }
</center>

While not a study site itself, there are a lot of studies and data products that focus on Svalbard broadly, rather than individual study sites within this region. Therefore this geographical region has it's own meta-data table. The primary drivers of change for each site are still listed in their own tables.

<!-- #### Tables {.tabset .tabset-fade .tabset-pills}  -->

<!-- ##### Drivers {-} -->

```{r svalbard-table}
knitr::kable(data.frame(Category = c("Biological"),
                        Driver = c("Seabirds"),
                        Why = c("Changes in top down predation can affect most trophic levels"),
                        Reference = c(""))) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "responsive")) %>% 
  # row_spec(1:3, background = "mintcream") %>%
  # row_spec(4:7, color = "black", background = "skyblue") %>%
  # row_spec(8, background = "#F6EA7C") %>% 
  row_spec(1, background = "#A2ED84") #%>% 
  # row_spec(12, background = "#F48080")
```

<!-- ##### Meta-data {-} -->

```{r svalbard-meta-data}
# Glacial topography + thickness
sval_glacier_mass <- data.frame(data_name = "Glacier mass balance",
                                date_range = "1967 to 2019", #date_min = 1967, date_max = 2019,
                                lon_range = NA, #lon_min = NA, lon_max = NA, 
                                lat_range = NA, #lat_min = NA, lat_max = NA,
                                depth_range = NA, #depth_min = NA, depth_max = NA,
                                file_name = '<a onclick="alert(\'cumulative-mass-balance-for-glaciers-in-svalbard.csv      austre-broggerbreen-mass-balance.csv      etonbreen-austfonna-mass-balance.csv      kongsvegen-mass-balance.csv      kronebreenholtedahlfonna-mass-balance.csv      midtre-lovenbreen-mass-balance.csv\');">6 files</a>',
                                URL = '<a target="_blank" rel="noopener noreferrer" href="https://www.mosj.no/en/climate/land/mass-balance-glaciers.html">MOSJ</a>',
                                reference = "See website",
                                note = NA)

# Tidal glacier fronts
sval_tidal_glacier_front <- data.frame(data_name = "Tidal glacier front",
                                       date_range = "2015 to 2019",
                                       lon_range = "9 to 36",
                                       lat_range = "76 to 81",
                                       depth_range = NA,
                                       file_name = '<a onclick="alert(\'Tidewater/\');">1 folder</a>',
                                       URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/7cd67b1a-1b9b-4dfd-b7a1-f9469597ed4d">NPDC</a>',
                                       reference = '<a onclick="alert(\'Kohler, J., König, M., Nuth, C., & Villaflor, G. (2018). Svalbard tidewater glacier front database [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2018.7cd67b1a\');">Kohler et al. (2018)</a>',
                                       note = NA)

# Surface meteorology
sval_surface_met <- tidync("~/pCloudDrive/FACE-IT_data/svalbard/N-ICE_metData_v2.nc") %>% 
  hyper_tibble() %>% 
  dplyr::select(year, longitude, latitude) %>% 
  make_meta_data(data_name = "Air temperature/pressure + relative humidity + wind speed/direction",
                 file_name = '<a onclick="alert(\'N-ICE_metData_v2.nc      N-ICE_metData_QC.py      README_N-ICE_metData_v2.txt\');">3 files</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/056a61d1-d089-483a-a256-081de4f3308d">NPDC</a>',
                 reference = '<a onclick="alert(\'Hudson, S. R., Cohen, L., & Walden, V. (2015). N-ICE2015 surface meteorology [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2015.056a61d1\');">Hudson et. (2015)</a>', 
                 note = "Has a python script to help with extracting.")

# UNIS database
sval_UNIS_database <- data.frame(data_name = "CTD: temperature + salinity",
                                 date_range = "1876 to 2019",
                                 lon_range = "0 to 75",
                                 lat_range = "34 to 83",
                                 depth_range = "? to ?",
                                 file_name = '<a onclick="alert(\'UNIS_hydrographic_database/\');">1 folder</a>',
                                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/39d9f0f9-af12-420c-a879-10990df2e22d">NPDC</a>',
                                       reference = '<a onclick="alert(\'Skogseth, R., Ellingsen, P., Berge, J., Cottier, F., Falk-Petersen, S., Ivanov, B., … Vader, A. (2019). UNIS hydrographic database [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/unis-hydrography\');">Skogseth et al. (2019)</a>',
                                       note = NA)

# Seabird database
sval_seabird_database <- data.frame(data_name = "Seabird",
                                    date_range = "1880 to 2020",
                                    lon_range = "9 to 74",
                                    lat_range = "35 to 81",
                                    depth_range = NA,
                                    file_name = '<a onclick="alert(\'See the website\');">0 files</a>',
                                    URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/fd4fd3aa-7249-53c9-9846-6e28c5a42587">NPDC</a>',
                                    reference = '<a onclick="alert(\'Strøm, H., Descamps, S., & Bakken, V. . (2008). Seabird Colonies by the Barents Sea, White Sea and Kara Sea [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2008.fd4fd3aa\');">Strøm et al. (2008)</a>',
                                    note = NA)

# Combine
metadata_svalbard <- rbind(sval_glacier_mass, sval_tidal_glacier_front, sval_surface_met, sval_UNIS_database, sval_seabird_database)
```

<!-- <div style="margin-left: -200px;"> -->
```{r svalbard-meta-data-table}
DT::datatable(metadata_svalbard, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              caption = "All data files in this table are found within '~/pCloudDrive/FACE-IT_data/svalbard/'.")
```
<!-- </div>  -->

## Kongsfjorden

<center>
![](assets/map_kongsfjorden.png){ width=50% }
</center>

Much of the solar magnetic radiation going towards earth is focussed around Ny Alesund. This can have a knock on effect to air temperature when there are strong auroras: up to 4°C! Unfortunately models currently capture this effect very poorly. 

Land terminating glaciers around Kongsfjorden have been retreating linearly over the last decades. Water terminating glaciers retreat less linearly as there are occasions when the water terminating edge may surge forward, making it look like the terminating edge has improved. This is generally due to a destabilisation of the glacier that means an overall decrease in the glacier mass balance. 2020 was a record breaking warm year that has led to record breaking melts. Smaller glaciers are more susceptible to the increase in melt driven by climate change as they have smaller areas to accumulate ice etc. during the cold period of the year. 

Up until 2007 the fjord tended to be frozen 100% until February [@Pavlova2019]. Since 2007 the fjord has been having less and less surface freezing. This is in part due to Atlantic water encroachment. These waters are higher in aragonite and pH. These are also less turbid, allowing for more light for use with plankton etc. The plankton do respond to this with Atlantic species favoured in warmer years.

As to the influence of light, this has been increasing both due to increased melt and less ice cover throughout the year, in addition to increases in tourism. Besides increases in light pollution, longer times and broader areas of exposed sea surface also allows for a greater accumulation of positive downward heat flux. Of the four heat flux terms, it appears that increases in long wave radiation (Q_lw) over time are the leading cause of change to the cryosphere (@Bischof2019kongsfjorden). Following this, short wave radiation (Q_sw) is also increasing at a worrying rate, due in part to a decrease in cloud cover over the summer months [@Bischof2019kongsfjorden].

Because the higher trophic levels of Arctic ecosystems, including Kongsfjorden, are dominated by migratory species, such as sea birds, these will be less exposed to the build-up of contaminants in a given area. Such as those sources identified on Svalbard and around the Kongsfjorden area [@Granberg2017]. However, lower trophic level populations have shown the capacity to adapt rapidly enough to changes in local contamination that they are still able to carry contaminants up the food web [@Bischof2019kongsfjorden].

A large priority area of Kongsfjorden research moving forward must be the processes of exchange between the neighbouring fjords of Kongsfjorden and the Atlantic ocean [@Bischof2019kongsfjorden]. Progressing from this regional analysis, the work being done in the other areas of western Svalbard should be upscaled so as to provide the basis across which modelling work could connect these areas into a single integrated region. The understanding of the effects of physical drivers on ecosystems, with a focus on primary and secondary producers, is a particularly important area of focus [@Bischof2019kongsfjorden]. Ultimately, one of the main goals of identifying these drivers is to better enhanced the predictive capabilities of science in the region.

A study conducted _in situ_ compared biomass records from 2012-2014 against those from 1996-1998 and found that biomass had increased by 8.2 fold at the shallower depth of 2.5 m [@Bartsch2016]. These findings are similar to other macroalgae research throughout the Arctic that show a general increase in biomass accompanied by a shift to shallower depths. The physical processes that explain these observations are that increasing coastal sea-ice leads to less ice scour at these shallow depths, while less PAR is penetrating to the deeper range of macroalgae [@Bartsch2016].

The distribution, abundance, and species composition of pelagic macro zooplankton are very sensitive to oceanic changes. It was found that the warming occurring in the Kongsfjorden ecosystem is having a dramatic positive effect on the abundance of euphausiids and amphipods [@Dalpadado2016]. This is of particular importance as these are key prey species for target fishery species such as capelin and polar cod. As the borealisation of the fjord continues it may alter the population dynamics of prey species so dramatically that the changes may be tracked in the by monitoring the diets of the local black-legged kittiwakes [@Vihtakari2018].

```{r kongsfjorden-table}
knitr::kable(data.frame(Category = c("Cryosphere", "cryosphere",  "Cryoshpere",
                                     "Physical", "Physical", "Physical", "Physical",
                                     "Chemistry",
                                     "Biological", "Biological", "Biological",
                                     "Social"),
                        Driver = c("Sea-ice cover", "Land glacier mass balance", "Runoff",
                                   "Longwave radiation (Q_lw)", 
                                   "Shortwave radiation (Q_sw)", 
                                   "Turbidity",
                                   "Circulation",
                                   "Acidification",
                                   "Benthic macroalgal biomass/production",
                                   "Macro zooplankton",
                                   "Seabird diet",
                                   "Ship traffic"),
                        Why = c("Affects pelagic and benthic production.", 
                                "An indicator of the change to other drivers", 
                                "Alters salinity, nutrients, and turbidity of surface waters.",
                                "Primary driver of warming waters.", 
                                "Secondary driver of warming waters.", 
                                "Prevents light to benthic producers.",
                                "Allows for more encroachment of Atlantic waters.",
                                "Affects pelagic primary production.",
                                "Changes where coastal ecosystems will be found and at what scale.",
                                "Top down pressure on phytoplankton and a source of food higher up.",
                                "Changes to prey items serve as an indicator of borealisation.",
                                "Indicative of direct anthropogenic disturbance."),
                        Reference = c("Bischof et al. (2019a)", "Pavlova et al. (2019)", "Bischof et al. (2019a)",
                                      "Bischof et al. (2019b)", "Bischof et al. (2019b)", "Bischof et al. (2019a)", "Hop and Wiencke (2019)",
                                      "Hop and Wiencke (2019)",
                                      "Bartsch et al. (2016)", "Dalpadado et al. (2016)", "Vihtakari et al. (2018)",
                                      ""))) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "responsive")) %>% 
  row_spec(1:3, background = "mintcream") %>%
  row_spec(4:7, color = "black", background = "skyblue") %>%
  row_spec(8, background = "#F6EA7C") %>% 
  row_spec(9:11, background = "#A2ED84") %>% 
  row_spec(12, background = "#F48080")
  # column_spec(popover = )
```

```{r kongsfjorden-meta-data}
# Sea ice cover
kong_sea_ice_inner <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_sea_ice_cover_data.csv", guess_max = 100000) %>% 
  make_meta_data(data_name = "Sea-ice cover",
                 file_name = '<a onclick="alert(\'Kongsfjorden_sea_ice_cover_data.csv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/74c7b236-b94d-48c5-a665-ffcd54e8e1b7">NPDC</a>',
                 reference = '<a onclick="alert(\'Gerland, S., & Pavlova, O. (2020). Sea ice coverage in inner Kongsfjorden, Svalbard, 2003-2019, version 1.0 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.74c7b236\');">Gerland & Pavlova (2020)</a>')

# Zooplankton abundance and species
kong_zoo_data <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/kf_zooplankton_sampling_meta.csv") %>% 
  dplyr::rename(depth_from = from, depth_to = to) %>% 
  make_meta_data(data_name = "Zooplankton species + abundance",
                 file_name = '<a onclick="alert(\'kf_zooplankton_sampling_meta.csv      kf_zooplankton_abundance_data.csv      kf_zooplankton_species_meta.csv\');">3 files</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/94b29b16-b03b-47d7-bfbc-1c3c4f7060d2">NPDC</a>',
                 reference = '<a onclick="alert(\'Hop H, Wold A, Vihtakari M, Daase M, Kwasniewski S, Gluchowska M, Lischka S, Buchholz F, Falk-Petersen S (2019) Zooplankton in Kongsfjorden (1996-2016) in relation to climate change. In: The ecosystem of Kongsfjorden, Svalbard (eds. Hop H, Wiencke C), Advances in Polar Ecology, Springer Verlag.\');">Hop et. (2019)</a>')

# Protist species and nutrients and Chla
kong_protist_nutrient_chla <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Metadata_Kongsfjorden2009-2014_Hegseth et al.csv") %>% 
  filter(Depth != 3831) %>% # These values are deeper than the bottom depth
  mutate(`Sampling date` = as.Date(`Sampling date`, "%Y%m%d")) %>% # Prep date data
  make_meta_data(data_name = "Protist species + Nutrients + Chla",
                 file_name = '<a onclick="alert(\'Metadata_Kongsfjorden2009-2014_Hegseth et al.csv      Protist_abundance_Kongsfjorden2009-2013_Hegseth et al.csv      Nutrients&Chla_Kongsfjorden2009-2014_Hegseth et al.csv\');">3 files</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/2bff82dc-22b9-41c0-8348-220e7d6ca4f4">NPDC</a>',
                 reference = '<a onclick="alert(\'Hegseth EN, Assmy P, Wiktor JM, Wiktor Jr. JM, Kristiansen S, Leu E, Tverberg V, Gabrielsen TM, Skogseth R and Cottier F (2019) Phytoplankton Seasonal Dynamics in Kongsfjorden, Svalbard and the Adjacent Shelf. In: The ecosystem of Kongsfjorden, Svalbard (eds. Hop H, Wiencke C), Advances in Polar Ecology, Springer Verlag.\');">Hegseth et. (2019)</a>',
                 note = "The lon/lat coordinates are suspect.") %>% 
  # mutate(lon_min = 9.50, lon_max = 9.55, lat_min = 78.90, lat_max = 79.10)
  mutate(lon_range = "95 to 95.5", lat_range = "78.9 to 79.1")

# CTD sampling data
kong_CTD_database <- tidync("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_ctd_1906_2017.nc") %>% 
  activate("D1") %>% hyper_tibble() %>% 
  dplyr::rename(date = TIME, lat = LATITUDE, lon = LONGITUDE, depth = FDEP) %>% 
  mutate(date = as.Date(date, origin = "1950-01-01")) %>% 
  make_meta_data(data_name = "CTD: temperature + salinity",
                 file_name = '<a onclick="alert(\'Kongsfjorden_ctd_1906_2017.nc\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/074a215c-d1df-47a9-bea7-e0fcc37273c6">NPDC</a>',
                 reference = '<a onclick="alert(\'Skogseth, R., Tverberg, V., Walczowski, W., & Sundfjord, A. (2019). Kongsfjorden Transect CTD data 1906-2016 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2019.074a215c\');">Skogseth et. (2019)</a>')

# CO2 data
kong_CTD_CO2 <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_Marine_CO2_system_2012_to_2014.csv") %>% 
  dplyr::rename(date = `yyyy-mm-dd`) %>% 
    make_meta_data(data_name = "CTD: temperature + salinity + alkalinity (TA) + DIC",
                   file_name = '<a onclick="alert(\'Kongsfjorden_Marine_CO2_system_2012_to_2014.csv\');">1 file</a>',
                   URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/e53eae53-147a-45df-b473-917bb5ba1ed4">NPDC</a>',
                   reference = '<a onclick="alert(\'Fransson, A., & Chierici, M. (2019). Marine CO2 system data for the Svalbard fjord Kongsfjorden and the West-Spitsbergen shelf in July 2012-2014 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2019.e53eae53\');">Fransson & Chierici (2019)</a>')

# Glacial topography + thickness
kong_glacier_info <- data.frame(data_name = "Glacier surface + thickness + elevation",
                                # date_min = 2004, date_max = 2016,
                                date_range = "2004 to 2016",
                                # lon_min = 10, lon_max = 14, lat_min = 78.8, lat_max = 79.2,
                                lon_range = "10 to 14", lat_range = "78.8 to 79.2",
                                # depth_min = NA, depth_max = NA,
                                depth_range = NA,
                                file_name = '<a onclick="alert(\'TIGRIF_DEM_ice_surface_150m_v1.tif      TIGRIF_DEM_ice_thickness_150m_1.tif      TIGRIF_DEM_subglacial_elevation_150m_v1.tif      TIGRIF_radarprofiles_2004_2016_v1.txt\');">4 files</a>',
                                URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/702ca4a7-7d02-462c-8cbd-2d80d0e977a1">NPDC</a>',
                                reference = '<a onclick="alert(\'Lindbäck, K., Kohler, J., Pettersson, R., Nuth, C., Langley, K., Messerli, A., … Brandt, O. (2018). Subglacial topography, ice thickness, and bathymetry of Kongsfjorden, northwestern Svalbard [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2017.702ca4a7\');">Lindbäck et al. (2018)</a>',
                                note = NA)

# Kongsvegen weather station
kong_weather_station <- read_tsv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsvegen-weather.tsv", n_max = 100000) %>% 
  dplyr::rename(date = timestamp) %>% 
  make_meta_data(data_name = "Kongsvegen weather station: longwave + shortwave + air temperature + humidity + wind",
                 file_name = '<a onclick="alert(\'Kongsvegen-weather.tsv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/5dc31930-0922-4483-a1df-6f48af9e371b">NPDC</a>',
                 reference = '<a onclick="alert(\'Kohler, J., Hudson, S. R., & Obleitner, F. (2017). Automatic weather station data from Kongsvegen, Ny-Ålesund [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2017.5dc31930\');">Kohler et al. (2017)</a>',
                 note = "See website for full list of variables.")

# Unknown data
# test <- read_tsv("~/pCloudDrive/FACE-IT_data/kongsfjorden/unentered/2009-2013-pigments-api-v1.tsv")

# Bind them together
metadata_kongsfjorden <- rbind(kong_sea_ice_inner, kong_zoo_data, kong_protist_nutrient_chla, kong_CTD_database, kong_CTD_CO2, kong_glacier_info, kong_weather_station)
```

<!-- See if it's possible to have ghost columns to aid in searching for variables -->
<!-- COmbine the smaller metadata columns into text strings -->

<!-- <div style="margin-right: -200px;"> -->
```{r kongsfjorden-meta-data-table}
DT::datatable(metadata_kongsfjorden, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              caption = "All data files in this table are found within '~/pCloudDrive/FACE-IT_data/kongsfjorden/'.")
```
<!-- </div> -->

## Isfjorden

<center>
![](assets/map_isfjorden.png){ width=50% }
</center>

Changes to the abundance of euphausiids and amphipods have been noted in Isfjorden, but not to the same extent as Kongsfjorden [@Dalpadado2016]. This is attributed primarily to the fact that the thermal regime of Isfjorden is not changing as rapidly as Kongsfjorden. Likely because Isfjorden does not experience as much encroachment from the Atlantic.

Atlantic inflows of water in the late summer can create pelagic microbial communities more similar to periods of summer stratification [@Delpech2021]. On the other end of the fjord, high riverine inputs can have a different effect on the expected microbial community for the time of year.

Fast ice, e.g. sea-ice attached to the coast, has decreased significantly in the fjord [@Muckenhuber2016]. The shift appears to have been most pronounce from 2006. Fast ice coverage correlates well with remotely sensed SST and and _in situ_ air temperatures, meaning that these could perhaps be used as proxies where no ice cover data are available. As fast ice cover began to decrease more rapidly, there was an observed uptick in the heat content of the fjord in Autumn [@Muckenhuber2016]. The authors allude to, without concluding that, changes in sea ice cover must have a discernible connection to changes in heat flux into the ocean. Likely in both strength and phenology.

Atlantic Water (AW) has traditionally formed much of the bottom layer of the fjord in summer, but starting in 2006 a shift has begun in which AW is occupying much more of the water column [@Skogseth2020]. In combination with the disappearance of fast ice, this is one of the main forces attributed to the increasing SST trend of 0.7°C/dec. @Skogseth2020 therefore conclude that the increased AW advection is the main reason for the changing climate of Isfjorden. The advection of AW into the fjord, and therefore the warming that it causes, is largely dictated by the competition between the Spitsbergen Polar Current (Arctic Water) and the Spitsbergen Trough Current (AW). AS the borealisation of the Arctic continues, the advection of AW into the fjord is only likely to increase. These inflows of AW are driven largely by changes to the patterns of the wind stress field in the area [@Pavlov2013]. Mean sea-level pressure (MSLP) data can be used as a proxy to determine changes in wind stress, and @Pavlov2013 used ERA data to do so. This climate reanalysis product is freely available from CMEMS and is commonly used in climate science.

For zooplankton communities in the fjord, seasonality is the largest predictive factor [@Vereide2019]. This is however influenced by local scale perturbations in temperature, salinity, and light availability. Therefore, anything affecting these variables, such as runoff from glaciers and rivers, will also affect the zooplankton communities. As the Arctic warms, runoff will almost certainly increase, meaning that this will likely be a noteworthy driver of change. Accompanying these changes brought on by increased runoff are the changes to nutrient inflow from land to sea. Nutrient concentrations in rivers can be 12-fold higher than in the fjord [@Mcgovern2020]. So as increased warming leads to increased melt leads to increased runoff leads to increased nutrient input, the biogeochemical properties of the fjord are projected to change apace with climate [@Mcgovern2020]. One must remember however that with increased runoff comes increased turbidity, which may have a counteracting effect to nutrient input by preventing access to light at the surface. The effects of these fresh water plumes on coastal communities is very dramatic but also tends to be very localised [@Mcgovern2020]. They can be captured with some fidelity using remotely sensed ocean colour data, but future studies should aim to use not only high spatial resolution data, but high temporal resolutions as well in order to better resolve seasonal changes driven by this phenomenon [@Mcgovern2020]. 

In support of this line of reasoning, surveys of benthic macrofauna in the smaller adjoining fjords has shown that small scale local differences in physical variables have a much stronger relationship to local community structure than do any fjord-wide gradients [@Ugelstad2019]. @Ugelstad2019 also found that species richness was higher in less disturbed environments. This implies that as the fjord continues to change, species that are able to persist at deeper depths (which will also be subject to less PAR) may have more time to adapt to the changing climate. Conversely, we also know that it is these deper areas that are experiencing increased amounts of AW inflow [@Skogseth2020]. So with increased runoff into the surface waters, and a rising of AW from below, it appears that the comfortable historic ranges for species in the fjord and it's adjoining systems are being pinched off.

```{r isfjorden-table}
knitr::kable(data.frame(Category = c("Cryosphere", 
                                     "Physical", "Physical", "Physical",
                                     "Chemistry",
                                     "Biological", "Biological", "Biological",
                                     "Social", "Social"),
                        Driver = c("Fast ice cover",
                                   "Atlantic water inflow",
                                   "Freshwater runoff",
                                   "Wind stress",
                                   "Nutrient input",
                                   "Microbial communtiy",
                                   "Zooplankton community",
                                   "Benthic community",
                                   "Fish landings",
                                   "Tourism arrivals"),
                        Why = c("Decreasing (fast) ice cover can have a range of ecological effect.",
                                "Increases the temperature and salinity of fjord waters.",
                                "Changes the temperature, salinity, and turbidity of surface waters.",
                                "Responsible for increasing Atlantic water inflow from the West Spitsbergen Current.",
                                "Can tip ecological balances by inordinately favouring some species over others.",
                                "Affects the decomposition of material.",
                                "Foundational prey species for many pelagics.",
                                "Contribute to biogeochemical processes; re-mineralise nutrients; food for higher trophic levels.",
                                "Alters top down trophic pressure.",
                                "Increases to a range of pollutants from light to chemical."),
                        Reference = c("Muckenhuber et al. (2016)", 
                                      "Skogseth et al. (2020)", "Vereide (2019); Mcgovern et al. (2020)", "Pavlov et al. (2013)",
                                      "Mcgovern et al. (2020)",
                                      "Delpech et al. (2021)", "Vereide (2019)", "Ugelstad (2019)",
                                      "", ""))) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "responsive")) %>% 
  row_spec(1, background = "mintcream") %>%
  row_spec(2:4, color = "black", background = "skyblue") %>%
  row_spec(5, background = "#F6EA7C") %>%
  row_spec(6:8, background = "#A2ED84") %>%
  row_spec(9:10, background = "#F48080")
  # column_spec(popover = )
```

```{r isfjorden-meta-data}
# Sea ice cover
kong_sea_ice_inner <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_sea_ice_cover_data.csv", guess_max = 100000) %>% 
  make_meta_data(data_name = "Sea-ice cover",
                 file_name = '<a onclick="alert(\'Kongsfjorden_sea_ice_cover_data.csv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/74c7b236-b94d-48c5-a665-ffcd54e8e1b7">NPDC</a>',
                 reference = '<a onclick="alert(\'Gerland, S., & Pavlova, O. (2020). Sea ice coverage in inner Kongsfjorden, Svalbard, 2003-2019, version 1.0 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.74c7b236\');">Gerland & Pavlova (2020)</a>')

# Unknown data
# test <- read_tsv("~/pCloudDrive/FACE-IT_data/kongsfjorden/unentered/2009-2013-pigments-api-v1.tsv")

# Bind them together
metadata_isfjorden <- rbind(kong_sea_ice_inner)
```

_NB: This is just a place holder until Isfjorden data are added._
```{r isfjorden-meta-data-table}
DT::datatable(metadata_isfjorden, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              caption = "All data files in this table are found within '~/pCloudDrive/FACE-IT_data/isfjorden/'.")
```

## Inglefieldbukta

<center>
![](assets/map_inglefieldbukta.png){ width=50% }
</center>

# Greenland

See the EU Arctic figure above for where the Greenland sites are located. They are too spread out to be shown here in a single figure with any better precision than the full study area.

## Young Sound

<center>
![](assets/map_young_sound.png){ width=50% }
</center>

## Disko Bay

<center>
![](assets/map_disko_bay.png){ width=50% }
</center>

## Nuup Kangerlua

<center>
![](assets/map_nuup_kangerlua.png){ width=50% }
</center>

# Norway

## Porsangerfjorden

<center>
![](assets/map_porsangerfjorden.png){ width=50% }
</center>

# References
