---
title: "Meta-database: environmental and societal drivers of change in Arctic fjord ecosystems"
author: "Robert Schlegel"
date: '`r format(Sys.Date(), "%d %B %Y")`'
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
css: acid.css
csl: frontiers.csl
bibliography: FACE-IT.bib
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.align = 'center',
                      echo = FALSE, warning = FALSE, message = FALSE, 
                      eval = TRUE, tidy = FALSE)
```

<center>
![](assets/FACE-IT_Logo_900.png){ width=70% }
</center>

# Overview

```{r setup}
# Necessary libraries
library(tidyverse) # The tidy dialect of R
library(tidync) # For reading NetCDF
library(DT) # For interactive tables
library(kableExtra) # For formatting static tables
# library(htmltools) # For additional HTML options
# library(bsplus) # For additional buttons
# library(ijtiff) # For reading the glacier tif files

# Table column names
DT_cols <- c("Name", "Date", "Longitude", "Latitude", "Depth", "File(s)", "Link", "Reference", "Note(s)")

# Datatable options for all tables
options(DT.options = list(pageLength = 5,
                          # autoWidth = TRUE,
                          # This chunk of code only allows six characters to be shown in a column
                          # But it interferes with the HTML code for popups and links
                          # columnDefs = list(list(
                          #   targets = list(9),
                          #   render = JS(
                          #     "function(data, type, row, meta) {",
                          #     "return type === 'display' && data.length > 6 ?",
                          #     "'<span title=\"' + data + '\">' + data.substr(0, 6) + '...</span>' : data;",
                          #     "}"))),
                          # columnDefs = list(list(width = '20%', targets = c(2))),
                          deferRender = TRUE,
                          # scrollX = TRUE,
                          scrollY = 400,
                          scrollCollapse = TRUE,
                          lengthMenu = c(5, 10, 25, 50, 100)))
```

```{r meta-data-setup}
# Function for smoother meta-data creation
make_meta_data <- function(dat, data_name, file_name, URL, reference, note = NA){
  
  # Find longitude range
  lon_col <- c(colnames(dat)[str_detect(colnames(dat), "lon")],
               colnames(dat)[str_detect(colnames(dat), "Lon")])
  if(length(lon_col) > 0){
    lon_min <- round(min(dat[,lon_col], na.rm = T), 2)
    lon_max <- round(max(dat[,lon_col], na.rm = T), 2)
    lon_range <- paste0(lon_min," to ", lon_max)
  } else {
    lon_min <- NA; lon_max <- NA
    lon_range <- NA
  }
  
  # Find latitude range
  lat_col <- c(colnames(dat)[str_detect(colnames(dat), "lat")],
               colnames(dat)[str_detect(colnames(dat), "Lat")])
  if(length(lat_col) > 0){
    lat_min <- round(min(dat[,lat_col], na.rm = T), 2)
    lat_max <- round(max(dat[,lat_col], na.rm = T), 2)
    lat_range <- paste0(lat_min," to ", lat_max)
  } else {
    lat_min <- NA; lat_max <- NA
    lat_range <- NA
  }
  
  # Find depth range
  depth_col <- c(colnames(dat)[str_detect(colnames(dat), "depth")],
                 colnames(dat)[str_detect(colnames(dat), "Depth")])
  depth_col <- depth_col[!str_detect(depth_col, "bot")]
  depth_col <- depth_col[!str_detect(depth_col, "Bot")]
  if(length(depth_col) > 0){
    depth_min <- round(min(dat[,depth_col], na.rm = T), 2)
    depth_max <- round(max(dat[,depth_col], na.rm = T), 2)
    depth_range <- paste0(depth_min," to ", depth_max)
  } else {
    depth_min <- NA; depth_max <- NA
    depth_range <- NA
  }

  # Find depth range
  date_col <- c(colnames(dat)[str_detect(colnames(dat), "date")],
                colnames(dat)[str_detect(colnames(dat), "Date")])
  year_col <- c(colnames(dat)[str_detect(colnames(dat), "year")],
                colnames(dat)[str_detect(colnames(dat), "Year")])
  if(length(date_col) > 0){
    date_dat <- dat[,date_col] %>% `colnames<-`("t")
    if(!is.na(as.Date(date_dat$t[1], "%Y-%m-%d"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%Y-%m-%d")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%Y-%m-%d")), na.rm = T)
    } else if(!is.na(as.Date(date_dat$t[1], "%Y%m%d"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%Y%m%d")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%Y%m%d")), na.rm = T)
    }else if(!is.na(as.Date(date_dat$t[1], "%Y/%m/%d"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%Y/%m/%d")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%Y/%m/%d")), na.rm = T)
    } else if(!is.na(as.Date(date_dat$t[1], "%d/%m/%Y"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%d/%m/%Y")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%d/%m/%Y")), na.rm = T)
    } else if(!is.na(as.Date(date_dat$t[1], "%m/%d/%Y"))){
    date_min <- min(lubridate::year(as.Date(date_dat$t, "%m/%d/%Y")), na.rm = T)
    date_max <- max(lubridate::year(as.Date(date_dat$t, "%m/%d/%Y")), na.rm = T)
    } else {
      date_min <- NA; date_max <- NA
    }
  }
  if(is.na(depth_min) & length(year_col) > 0) {
    year_dat <- dat[,year_col] %>% `colnames<-`("year")
    date_min <- min(year_dat$year, na.rm = T)
    date_max <- max(year_dat$year, na.rm = T)
  }
  if(!is.na(date_min)){
    date_range <- paste0(date_min," to ", date_max)
  } else {
    date_range <- NA
  }
  
  # Determine ecoregions
  # Find point in MEOW polygons
  
  # Combine and output
  res <- data.frame(data_name, 
                    date_range, lon_range, lat_range, depth_range,
                    # date_min, date_max, lon_min, lon_max, lat_min, lat_max, depth_min, depth_max, 
                    file_name, URL, reference,
                    note)
  return(res)
}
```

This document is designed to satisfy D1.2 for the Horizon2020 project [FACE-IT](https://www.face-it-project.eu/). The interactive tables contain the meta-database for the data that contain variables identified as key drivers of change ([D1.1](https://face-it-project.github.io/WP1/key_drivers.html)). The meta-data from this document will be used for the completion of a review article on past and future changes of key drivers in and around the FACE-IT study sites ([D1.3](https://face-it-project.github.io/WP1/review.html)). The meta-database has been broken up into the different sites for convenience, with a table of meta-data given for the relevant data per site. This means that some meta-data will be repeated in the tables below as some data files are relevant to multiple sites.

<!-- The current thinking with this is to list all of the data of interest by site and provide a quick meta-data summary for each (e.g. start-end date, temporal/spatial resolution) as well as providing the correct citation for each data source. -->

<!-- Thinking now, it may be better to create this as an RMarkdown document. This way the links and code used can be housed directly in with the text talking about the data availability, meta-data and citations. -->

<!-- Start with a discussion of what the key drivers are across all study sites. A literature search of keywords can be used to generate info on the key drivers: Arctic, biodiversity, drivers, etc. Do this for titles, abstracts, and keywords. For each study site afterwards one can discuss why some drivers are more or less important. Like light pollution in Young Sound, because there are no humans there. Or like ice cover in Kongsfjorden being very important because of borealisation. -->

<!-- One must list all available data, but this does not mean they all need to be downloaded. And it does not mean that they all need to be combined. Consider that trends are going to be one of the main benefits of combining multiple data sets. -->

<!-- Start with combining temperature data so that we can get trends as much as possible. Allow for one to choose a box and to get a trend from the points in the area. -->

# European Arctic

<center>
![](assets/map_full.png){ width=50% }
</center>

This section contains meta-data for pan-Arctic data files. These are almost exclusively large gridded data sets or large combined sets of CTD data.

<!-- _NB: This is one option for how to show tabular information. I've put the tables behind these buttons so that only one is shown at a time. Lower down in this document all tables are shown together. I'm curious to know what people prefer._ -->

<!-- #### Tables {.tabset .tabset-fade .tabset-pills}  -->

<!-- ##### Meta-data {-} -->

```{r EU-arctic-meta-data}
# Zooplankton biodiversity
EU_zooplankton <- read_tsv("~/pCloudDrive/FACE-IT_data/EU_arctic/1995-2008-zooplankton-biodiversity.tsv", guess_max = 100000) %>% 
  make_meta_data(data_name = 'Zooplankton biodiversity',
                 file_name = '<a onclick="alert(\'1995-2008-zooplankton-biodiversity.tsv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/9167dae8-cab2-45b3-9cea-ad69541b0448">NPDC</a>',
                 reference = '<a onclick="alert(\'Norwegian Polar Institute (2020). Marine zooplankton and icefauna biodiversity [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.9167dae8\');">NPI (2020)</a>')

# Ice modelling output
EU_ice <- data.frame(data_name = "Model: ice thickness, snow-ice, snow depth",
                     date_range = "1980 to 2016",
                     lon_range = "-180 to 180",
                     lat_range = "60 to 90",
                     depth_range = NA,
                     file_name = '<a onclick="alert(\'See the website\');">0 files</a>',
                     URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/881e423a-b6f6-4c1a-8000-d802adf03a66">NPDC</a>',
                     reference = '<a onclick="alert(\'Liston, G., Merkouriadi, I., & Granskog, M. A. (2019). Snow-ice, snow depth and ice thickness from HIGHTSI modeling with ice motion in the Arctic Ocean in the period 1980 to 2016 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2019.881e423a\');">Liston et al. (2016)</a>',
                     note = "The file is too large to download from NPDC.")

# CTD data from YMER cruise in 1980
EU_YMER <- data.frame(data_name = "CTD + bottles: temperature, salinity, oxygen, nutrients",
                      date_range = "1980-08-11 to 1980-09-19",
                      lon_range = "-16.462 to 46.883", 
                      lat_range = "74 to 82.5",
                      depth_range = "101 to 5460",
                      file_name = '<a onclick="alert(\'77YM19800811.exc.csv\');">1 file</a>',
                      URL = '<a target="_blank" rel="noopener noreferrer" href="https://www.ncei.noaa.gov/data/oceans/ncei/ocads/metadata/0113607.html">NOAA</a>',
                      reference = '<a onclick="alert(\'Anderson, Leif G. (2013). Temperature, salinity and other variables collected from discrete sample and profile observations using CTD, bottle and other instruments from the YMER in the Arctic Ocean, Barents Sea and North Greenland Sea from 1980-08-11 to 1980-09-19 (NCEI Accession 0113607). [indicate subset used]. NOAA National Centers for Environmental Information. Dataset. https://doi.org/10.3334/cdiac/otg.carina_77ym19800811. Accessed [date].\');">Anderson (2013)</a>',
                      note = NA)

# CTD data from YMER cruise in 1980
EU_Codispoti <- data.frame(data_name = "CTD + bottles: temperature, salinity, nutrients",
                           date_range = "1928 to 2007",
                           lon_range = "-180 to 180",
                           lat_range = "60 to 90",
                           depth_range = "0 to 5352",
                           file_name = '<a onclick="alert(\'Codispoti_Arctic_Nutrients_Submission_11-11-2010.csv\');">1 file</a>',
                           URL = '<a target="_blank" rel="noopener noreferrer" href="https://www.nodc.noaa.gov/archive/arc0034/0072133/">NOAA</a>',
                           reference = '<a target="_blank" rel="noopener noreferrer" href="https://www.nodc.noaa.gov/archive/arc0034/0072133/1.1/data/1-data/ReadMe_Codispoti_ArcticNuts.pdf">Multiple</a>',
                      note = NA)

# Datasets downloaded from PANGEA, filtered by Topic “inorganic chemistry”, Method/Device “CTD/rosette” and Location “Arctic Ocean” in the geographic range 0° - 30°E 80° - 90°N. These datasets were obtained in cruises with RV Polarstern in the dates indicated in the second column. The listed references include links to the repositories where data can be found. Dates consider only periods when sampling took place in the domain of our study.
# Cruises: ARK-IV/2, ARK-IV/3, ARK-IV/2, ARK-XIII/2, ARK-XIV/2, ARK-XV/3, ARK-XXI/1, ARK-XXVII/3, ARK-XXIX/1, ARK-XXIX/3, ARK-XXX/2

# Combine
metadata_EU_arctic <- rbind(EU_zooplankton, EU_ice, EU_YMER, EU_Codispoti)
```

```{r EU-arctic-meta-data-table}
DT::datatable(metadata_EU_arctic, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              # filter = "top", 
              caption = "All files in this table are found within '~/pCloudDrive/FACE-IT_data/EU_arctic/'.")
```

# Svalbard

<center>
![](assets/map_svalbard.png){ width=70% }
</center>

While not a study site itself, there are a lot of studies and data products that focus on Svalbard broadly, rather than individual study sites within this region. Therefore this geographical region has it's own meta-data table. The primary drivers of change for each site are still listed in their own tables below.

```{r svalbard-meta-data}
# Glacial topography + thickness
sval_glacier_mass <- data.frame(data_name = "Glacier mass balance",
                                date_range = "1967 to 2019", #date_min = 1967, date_max = 2019,
                                lon_range = NA, #lon_min = NA, lon_max = NA, 
                                lat_range = NA, #lat_min = NA, lat_max = NA,
                                depth_range = NA, #depth_min = NA, depth_max = NA,
                                file_name = '<a onclick="alert(\'cumulative-mass-balance-for-glaciers-in-svalbard.csv      austre-broggerbreen-mass-balance.csv      etonbreen-austfonna-mass-balance.csv      kongsvegen-mass-balance.csv      kronebreenholtedahlfonna-mass-balance.csv      midtre-lovenbreen-mass-balance.csv\');">6 files</a>',
                                URL = '<a target="_blank" rel="noopener noreferrer" href="https://www.mosj.no/en/climate/land/mass-balance-glaciers.html">MOSJ</a>',
                                reference = "See website",
                                note = NA)

# Tidal glacier fronts
sval_tidal_glacier_front <- data.frame(data_name = "Tidal glacier front",
                                       date_range = "2015 to 2019",
                                       lon_range = "9 to 36",
                                       lat_range = "76 to 81",
                                       depth_range = NA,
                                       file_name = '<a onclick="alert(\'Tidewater/\');">1 folder</a>',
                                       URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/7cd67b1a-1b9b-4dfd-b7a1-f9469597ed4d">NPDC</a>',
                                       reference = '<a onclick="alert(\'Kohler, J., König, M., Nuth, C., & Villaflor, G. (2018). Svalbard tidewater glacier front database [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2018.7cd67b1a\');">Kohler et al. (2018)</a>',
                                       note = NA)

# Marine terminating glacier fronts
sval_marine_glacier_front <- data.frame(data_name = "Marine glacier front",
                                        date_range = "2008 to 2020",
                                       lon_range = "10 to 34",
                                       lat_range = "76 to 81",
                                       depth_range = NA,
                                       file_name = '<a onclick="alert(\'Glacier_Fronts/\');">1 folder</a>',
                                       URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/d60a919a-9cc8-4048-9686-df81bfdc2338">NPDC</a>',
                                       reference = '<a onclick="alert(\'Moholdt, G., Maton, J., Majerska, M., & Kohler, J. (2021). Annual frontlines of marine-terminating glaciers on Svalbard [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2021.d60a919a\');">Moholdt et al. (2021)</a>',
                                       note = NA)

# Surface meteorology
sval_surface_met <- tidync("~/pCloudDrive/FACE-IT_data/svalbard/N-ICE_metData_v2.nc") %>% 
  hyper_tibble() %>% 
  dplyr::select(year, longitude, latitude) %>% 
  make_meta_data(data_name = "Air temperature/pressure + relative humidity + wind speed/direction",
                 file_name = '<a onclick="alert(\'N-ICE_metData_v2.nc      N-ICE_metData_QC.py      README_N-ICE_metData_v2.txt\');">3 files</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/056a61d1-d089-483a-a256-081de4f3308d">NPDC</a>',
                 reference = '<a onclick="alert(\'Hudson, S. R., Cohen, L., & Walden, V. (2015). N-ICE2015 surface meteorology [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2015.056a61d1\');">Hudson et. (2015)</a>', 
                 note = "Has a python script to help with extracting.")

# UNIS database
sval_UNIS_database <- data.frame(data_name = "CTD: temperature + salinity",
                                 date_range = "1876 to 2019",
                                 lon_range = "0 to 75",
                                 lat_range = "34 to 83",
                                 depth_range = "? to ?",
                                 file_name = '<a onclick="alert(\'CTD_all_1876-2019.nc\');">1 file</a>',
                                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/39d9f0f9-af12-420c-a879-10990df2e22d">NPDC</a>',
                                       reference = '<a onclick="alert(\'Skogseth, R., Ellingsen, P., Berge, J., Cottier, F., Falk-Petersen, S., Ivanov, B., … Vader, A. (2019). UNIS hydrographic database [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/unis-hydrography\');">Skogseth et al. (2019)</a>',
                                       note = NA)

# Seabird database
sval_seabird_database <- data.frame(data_name = "Seabird Colonies",
                                    date_range = "1880 to 2020",
                                    lon_range = "9 to 74",
                                    lat_range = "35 to 81",
                                    depth_range = NA,
                                    file_name = '<a onclick="alert(\'See the website\');">0 files</a>',
                                    URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/fd4fd3aa-7249-53c9-9846-6e28c5a42587">NPDC</a>',
                                    reference = '<a onclick="alert(\'Strøm, H., Descamps, S., & Bakken, V. . (2008). Seabird Colonies by the Barents Sea, White Sea and Kara Sea [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2008.fd4fd3aa\');">Strøm et al. (2008)</a>',
                                    note = NA)

# Protection of sites
sval_protection <- data.frame(data_name = "Protection of geological sites",
                              date_range = "1993 to 2020",
                              lon_range = "20 to 80",
                              lat_range = "45 to 81",
                              depth_range = NA,
                              file_name = '<a onclick="alert(\'See the website\');">0 files</a>',
                              URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/117acc0c-7d6e-5c58-bb80-bb220780f406">NPDC</a>',
                              reference = '<a onclick="alert(\'Blomeier, D. P. G., & Hjelle, A. (2008). Protection of geological sites [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2008.117acc0c\');">Blomeier et al. (2008)</a>',
                              note = NA)

# N-ICE21015 many data products
sval_NICE <- data.frame(data_name = "N-ICE2015: most drivers",
                        date_range = "2015-01-11 to 2017-06-24",
                        lon_range = "-12.48 to 35.51", 
                        lat_range = "68.53 to 84.96",
                        depth_range = "? to ?",
                        file_name = '<a onclick="alert(\'See the website\');">0 files</a>',
                        URL = '<a target="_blank" rel="noopener noreferrer"
                        href="https://data.npolar.no/dataset/7f7e56d0-9e70-4363-b37d-17915e09a935">NPDC</a>',
                        reference = '<a onclick="alert(\'Norwegian Polar Institute (2016). N-ICE2015 datasets [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2016.7f7e56d0\');">Norwegian Polar Institute (2016)</a>',
                        note = "Follow the URL to see the list of the individual files with data for many drivers.")

# Combine
metadata_svalbard <- rbind(sval_glacier_mass, sval_tidal_glacier_front, sval_surface_met, sval_UNIS_database, 
                           sval_seabird_database, sval_protection, SVAL_NICE)
```

<!-- <div style="margin-left: -200px;"> -->
```{r svalbard-meta-data-table}
DT::datatable(metadata_svalbard, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              caption = "All data files in this table are found within '~/pCloudDrive/FACE-IT_data/svalbard/'.")
```
<!-- </div>  -->

## Kongsfjorden

<center>
![](assets/map_kongsfjorden.png){ width=50% }
</center>

```{r kongsfjorden-meta-data}
# Sea ice cover
kong_sea_ice_inner <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_sea_ice_cover_data.csv", guess_max = 100000) %>% 
  make_meta_data(data_name = "Sea-ice cover",
                 file_name = '<a onclick="alert(\'Kongsfjorden_sea_ice_cover_data.csv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/74c7b236-b94d-48c5-a665-ffcd54e8e1b7">NPDC</a>',
                 reference = '<a onclick="alert(\'Gerland, S., & Pavlova, O. (2020). Sea ice coverage in inner Kongsfjorden, Svalbard, 2003-2019, version 1.0 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.74c7b236\');">Gerland & Pavlova (2020)</a>')

# Zooplankton abundance and species
kong_zoo_data <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/kf_zooplankton_sampling_meta.csv") %>% 
  dplyr::rename(depth_from = from, depth_to = to) %>% 
  make_meta_data(data_name = "Zooplankton species + abundance",
                 file_name = '<a onclick="alert(\'kf_zooplankton_sampling_meta.csv      kf_zooplankton_abundance_data.csv      kf_zooplankton_species_meta.csv\');">3 files</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/94b29b16-b03b-47d7-bfbc-1c3c4f7060d2">NPDC</a>',
                 reference = '<a onclick="alert(\'Hop H, Wold A, Vihtakari M, Daase M, Kwasniewski S, Gluchowska M, Lischka S, Buchholz F, Falk-Petersen S (2019) Zooplankton in Kongsfjorden (1996-2016) in relation to climate change. In: The ecosystem of Kongsfjorden, Svalbard (eds. Hop H, Wiencke C), Advances in Polar Ecology, Springer Verlag.\');">Hop et. (2019)</a>')

# Protist species and nutrients and Chla
kong_protist_nutrient_chla <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Metadata_Kongsfjorden2009-2014_Hegseth et al.csv") %>% 
  filter(Depth != 3831) %>% # These values are deeper than the bottom depth
  mutate(`Sampling date` = as.Date(`Sampling date`, "%Y%m%d")) %>% # Prep date data
  make_meta_data(data_name = "Protist species + Nutrients + Chla",
                 file_name = '<a onclick="alert(\'Metadata_Kongsfjorden2009-2014_Hegseth et al.csv      Protist_abundance_Kongsfjorden2009-2013_Hegseth et al.csv      Nutrients&Chla_Kongsfjorden2009-2014_Hegseth et al.csv\');">3 files</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/2bff82dc-22b9-41c0-8348-220e7d6ca4f4">NPDC</a>',
                 reference = '<a onclick="alert(\'Hegseth EN, Assmy P, Wiktor JM, Wiktor Jr. JM, Kristiansen S, Leu E, Tverberg V, Gabrielsen TM, Skogseth R and Cottier F (2019) Phytoplankton Seasonal Dynamics in Kongsfjorden, Svalbard and the Adjacent Shelf. In: The ecosystem of Kongsfjorden, Svalbard (eds. Hop H, Wiencke C), Advances in Polar Ecology, Springer Verlag.\');">Hegseth et. (2019)</a>',
                 note = "The lon/lat coordinates are suspect.") %>% 
  # mutate(lon_min = 9.50, lon_max = 9.55, lat_min = 78.90, lat_max = 79.10)
  mutate(lon_range = "95 to 95.5", lat_range = "78.9 to 79.1")

# CTD sampling data
kong_CTD_database <- tidync("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_ctd_1906_2017.nc") %>% 
  activate("D1") %>% hyper_tibble() %>% 
  dplyr::rename(date = TIME, lat = LATITUDE, lon = LONGITUDE, depth = FDEP) %>% 
  mutate(date = as.Date(date, origin = "1950-01-01")) %>% 
  make_meta_data(data_name = "CTD: temperature + salinity",
                 file_name = '<a onclick="alert(\'Kongsfjorden_ctd_1906_2017.nc\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/074a215c-d1df-47a9-bea7-e0fcc37273c6">NPDC</a>',
                 reference = '<a onclick="alert(\'Skogseth, R., Tverberg, V., Walczowski, W., & Sundfjord, A. (2019). Kongsfjorden Transect CTD data 1906-2016 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2019.074a215c\');">Skogseth et. (2019)</a>')

# CO2 data
kong_CTD_CO2 <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_Marine_CO2_system_2012_to_2014.csv") %>% 
  dplyr::rename(date = `yyyy-mm-dd`) %>% 
    make_meta_data(data_name = "CTD: temperature + salinity + alkalinity (TA) + DIC",
                   file_name = '<a onclick="alert(\'Kongsfjorden_Marine_CO2_system_2012_to_2014.csv\');">1 file</a>',
                   URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/e53eae53-147a-45df-b473-917bb5ba1ed4">NPDC</a>',
                   reference = '<a onclick="alert(\'Fransson, A., & Chierici, M. (2019). Marine CO2 system data for the Svalbard fjord Kongsfjorden and the West-Spitsbergen shelf in July 2012-2014 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2019.e53eae53\');">Fransson & Chierici (2019)</a>')

# Glacial topography + thickness
kong_glacier_info <- data.frame(data_name = "Glacier surface + thickness + elevation",
                                date_range = "2004 to 2016",
                                lon_range = "10 to 14", lat_range = "78.8 to 79.2",
                                depth_range = NA,
                                file_name = '<a onclick="alert(\'TIGRIF_DEM_ice_surface_150m_v1.tif      TIGRIF_DEM_ice_thickness_150m_1.tif      TIGRIF_DEM_subglacial_elevation_150m_v1.tif      TIGRIF_radarprofiles_2004_2016_v1.txt\');">4 files</a>',
                                URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/702ca4a7-7d02-462c-8cbd-2d80d0e977a1">NPDC</a>',
                                reference = '<a onclick="alert(\'Lindbäck, K., Kohler, J., Pettersson, R., Nuth, C., Langley, K., Messerli, A., … Brandt, O. (2018). Subglacial topography, ice thickness, and bathymetry of Kongsfjorden, northwestern Svalbard [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2017.702ca4a7\');">Lindbäck et al. (2018)</a>',
                                note = NA)

# Kongsvegen weather station
kong_weather_station <- read_tsv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsvegen-weather.tsv", n_max = 100000) %>% 
  dplyr::rename(date = timestamp) %>% 
  make_meta_data(data_name = "Kongsvegen weather station: longwave + shortwave + air temperature + humidity + wind",
                 file_name = '<a onclick="alert(\'Kongsvegen-weather.tsv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/5dc31930-0922-4483-a1df-6f48af9e371b">NPDC</a>',
                 reference = '<a onclick="alert(\'Kohler, J., Hudson, S. R., & Obleitner, F. (2017). Automatic weather station data from Kongsvegen, Ny-Ålesund [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2017.5dc31930\');">Kohler et al. (2017)</a>',
                 note = "See website for full list of variables.")

# Unknown data
# test <- read_tsv("~/pCloudDrive/FACE-IT_data/kongsfjorden/unentered/2009-2013-pigments-api-v1.tsv")

# Bind them together
metadata_kongsfjorden <- rbind(kong_sea_ice_inner, kong_zoo_data, kong_protist_nutrient_chla, kong_CTD_database, kong_CTD_CO2, kong_glacier_info, kong_weather_station)
```

<!-- See if it's possible to have ghost columns to aid in searching for variables -->
<!-- Combine the smaller metadata columns into text strings -->

<!-- <div style="margin-right: -200px;"> -->
```{r kongsfjorden-meta-data-table}
DT::datatable(metadata_kongsfjorden, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              caption = "All data files in this table are found within '~/pCloudDrive/FACE-IT_data/kongsfjorden/'.")
```
<!-- </div> -->

## Isfjorden

<center>
![](assets/map_isfjorden.png){ width=50% }
</center>

```{r isfjorden-meta-data}
# Mouth mooring North
is_mooring_N <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_sea_ice_cover_data.csv", guess_max = 100000) %>% 
  make_meta_data(data_name = "Sea-ice cover",
                 file_name = '<a onclick="alert(\'Kongsfjorden_sea_ice_cover_data.csv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/74c7b236-b94d-48c5-a665-ffcd54e8e1b7">NPDC</a>',
                 reference = '<a onclick="alert(\'Gerland, S., & Pavlova, O. (2020). Sea ice coverage in inner Kongsfjorden, Svalbard, 2003-2019, version 1.0 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.74c7b236\');">Gerland & Pavlova (2020)</a>')

# Mouth mooring South
is_mooring_N <- read_csv("~/pCloudDrive/FACE-IT_data/kongsfjorden/Kongsfjorden_sea_ice_cover_data.csv", guess_max = 100000) %>% 
  make_meta_data(data_name = "Sea-ice cover",
                 file_name = '<a onclick="alert(\'Kongsfjorden_sea_ice_cover_data.csv\');">1 file</a>',
                 URL = '<a target="_blank" rel="noopener noreferrer" href="https://data.npolar.no/dataset/74c7b236-b94d-48c5-a665-ffcd54e8e1b7">NPDC</a>',
                 reference = '<a onclick="alert(\'Gerland, S., & Pavlova, O. (2020). Sea ice coverage in inner Kongsfjorden, Svalbard, 2003-2019, version 1.0 [Data set]. Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.74c7b236\');">Gerland & Pavlova (2020)</a>')

# CO2 station at Tempelfjorden
is_CO2_tempelfjorden <- data.frame(data_name = "CTD: temperature, salinity, TA, pH~T~, EP TA",
                                date_range = "2015 to 2017",
                                lon_range = "16.945 to 17.353", lat_range = "78.391 to 78.441",
                                depth_range = "1.43 to 98",
                                file_name = '<a onclick="alert(\'Marine_CO2_system_data_from_Tempelfjorden_2015_to_2017.xlsx\');"1 file</a>',
                                URL = '<a target="_blank" rel="noopener noreferrer" href="https://sios-svalbard.org/metsis/display/metadata/?core=l1&datasetID=UNIS_MARINE_CO2_2019_1&calling_results_page=https://sios-svalbard.org/results?page=1">SIOS</a>',
                                reference = '<a onclick="alert(\'No reference provided by SIOS.\');">NA</a>',
                                note = NA)

# CO2 station at Tempelfjorden
is_met_station <- data.frame(data_name = "Met station: air temperature (2m), air presure (sea level, 2m), wind: speed+direction (10m), relative humidity",
                             date_range = "1934 to 2019",
                             lon_range = "13.6192", 
                             lat_range = "78.0625",
                             depth_range = NA,
                             file_name = '<a onclick="alert(\'SN99790.nc\');"1 file</a>',
                             URL = '<a target="_blank" rel="noopener noreferrer" href="https://sios-svalbard.org/metsis/display/metadata/?core=l1&datasetID=f1772639-91f9-5c2d-a0d1-5110ee186c3f&calling_results_page=https://sios-svalbard.org/results?page=1">SIOS</a>',
                             reference = '<a onclick="alert(\'No reference provided by SIOS.\');">NA</a>',
                             note = NA)

# Unknown data
# test <- read_tsv("~/pCloudDrive/FACE-IT_data/kongsfjorden/unentered/2009-2013-pigments-api-v1.tsv")

# Bind them together
metadata_isfjorden <- rbind(is_CO2_tempelfjorden, is_met_station)
```

```{r isfjorden-meta-data-table}
DT::datatable(metadata_isfjorden, rownames = FALSE, escape = FALSE, colnames = DT_cols,
              caption = "All data files in this table are found within '~/pCloudDrive/FACE-IT_data/isfjorden/'.")
```

## Inglefieldbukta

<center>
![](assets/map_inglefieldbukta.png){ width=50% }
</center>

# Greenland

See the EU Arctic figure above for where the Greenland sites are located. They are too spread out to be shown here in a single figure with any better precision than the full study area.

## Young Sound

<center>
![](assets/map_young_sound.png){ width=50% }
</center>

## Disko Bay

<center>
![](assets/map_disko_bay.png){ width=50% }
</center>

## Nuup Kangerlua

<center>
![](assets/map_nuup_kangerlua.png){ width=50% }
</center>

# Norway

## Porsangerfjorden

<center>
![](assets/map_porsangerfjorden.png){ width=50% }
</center>

# References
