---
title: "Meta-database"
author: "Robert Schlegel"
date: '`r format(Sys.Date(), "%d %B %Y")`'
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: false
editor_options:
  chunk_output_type: console
csl: frontiers.csl
bibliography: FACE-IT.bib
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.align = 'center',
                      echo = TRUE, warning = FALSE, message = FALSE, 
                      eval = TRUE, tidy = FALSE)
```

```{r setup, echo=FALSE}
# Necessary libraries
library(tidyverse)
library(DT)

# Function for smoother meta-data creation
make_meta_data <- function(file_name, data_type, URL, reference, other = NA){
  
  # Create full file name
  
  # determine the file type and load
  if(str_detect(file_name, ".tsv")){
    dat <- read_tsv(file_name, guess_max = 100000)
  } else {
    stop("File type not currently accounted for.")
  }
  
  # Find longitude range
  lon_col <- c(colnames(dat)[str_detect(colnames(dat), "lon")],
               colnames(dat)[str_detect(colnames(dat), "Lon")])
  lon_min <- min(dat[,lon_col], na.rm = T)
  lon_max <- max(dat[,lon_col], na.rm = T)
  
  # Find latitude range
  lat_col <- c(colnames(dat)[str_detect(colnames(dat), "lat")],
               colnames(dat)[str_detect(colnames(dat), "Lat")])
  lat_min <- round(min(dat[,lat_col], na.rm = T), 2)
  lat_max <- round(max(dat[,lat_col], na.rm = T), 2)
  
  # Find depth range
  depth_col <- c(colnames(dat)[str_detect(colnames(dat), "depth")],
                 colnames(dat)[str_detect(colnames(dat), "Depth")])
  depth_col <- depth_col[!str_detect(depth_col, "bottom")]
  depth_col <- depth_col[!str_detect(depth_col, "Bottom")]
  depth_min <- round(min(dat[,depth_col], na.rm = T), 2)
  depth_max <- round(max(dat[,depth_col], na.rm = T), 2)
  
  # Find depth range
  date_col <- c(colnames(dat)[str_detect(colnames(dat), "date")],
                colnames(dat)[str_detect(colnames(dat), "Date")])
  date_col <- dat[,date_col] %>% 
    `colnames<-`("t")
  date_min <- as.Date(min(date_col$t))
  date_max <- as.Date(max(date_col$t))
  
  # Determine ecoregions
  # Find point in MEOW polygons
  
  res <- data.frame(data_type, lon_min, lon_max, lat_min, lat_max, depth_min, depth_max, 
                    date_min, date_max, file_name, URL, reference)
  return(res)
}
```

## Introduction

This document is designed to satisfy both D1.1 and D1.2 for the Horizon2020 project "FACE-IT". The text in this document is a report on the key drivers of changes in Arctic biodiversity (D1.1). The tables contain the meta-database for the data identified as key drivers of change (D1.2). The text and meta-data from this document will be used for the completion of a review article on past and future changes of key drivers in and around the FACE-IT study sites (D1.3). We begin with a review of known drivers of change in the Arctic before focussing in on each individual FACE-IT study site to discuss any differences from the broader Arctic. Within each section a table is given that shows the meta-data for the drivers of change for the topic of that section.

## Drivers of change in the European Arctic

![](~/FACE-IT/figures/map_full.png)

Many physical processes are known to drive biodiversity in the Arctic. Unsurprisingly, the presence of sea ice is one of these controlling factors (@Pavlova2019). There are however many more, such as photosynthetically available radiation (PAR), ultraviolet radiation (UVR), and turbidity (@Hop2019). In addition to knowing what it is that may cause changes, it is necessary to identify the fonts of biodiversity that may be affected by these drivers. There are many taxa/species etc. that have been identified as important for monitoring throughout the Arctic.

```{r EU-arctic-meta-data, echo=FALSE}
EU_zooplankton <- make_meta_data(file_name = "~/pCloudDrive/FACE-IT_data/EU_arctic/1995-2008-zooplankton-biodiversity.tsv",
                                 data_type = "Zooplankton biodiversity",
                                 URL = "https://data.npolar.no/dataset/9167dae8-cab2-45b3-9cea-ad69541b0448",
                                 reference = "Norwegian Polar Institute (2020). Marine zooplankton and icefauna biodiversity [Data set]. 
                                 Norwegian Polar Institute. https://doi.org/10.21334/npolar.2020.9167dae8")
metadata_EU_arctic <- rbind(EU_zooplankton, EU_zooplankton)
```
```{r EU-arctic-meta-data-table}
DT::datatable(metadata_EU_arctic, rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T) )
```
<!-- Rather have the table be clickable, and the clicked entry pops-up with the larger bits of info. This will save on the width of the table. -->

## Svalbard

![](~/FACE-IT/figures/map_svalbard.png)

While not a study site itself, there are a lot of studies and data products that focuss on Svalbard broadly, rather than individual study sites within this region. Therefore this geographical region 

## References
