---
title: "SOCAT-GLODAP"
author: "Jean-Pierre Gattuso"
date: "2/9/2021"
output: html_document
---

```{r setup, include=FALSE}
# Start with common project code
# Find who is the user and define the pCloud path
if (Sys.getenv("LOGNAME") == "gattuso"){
  pCloud_path = "~/pCloud\ Drive/"
} else {
  pCloud_path = "~/pCloudDrive/" 
}
library(tidyverse)
library(data.table) # For 'fread'
library(doParallel) # For using multiple cores
library(tidync)
```

```{r read socat, message=FALSE, warning=FALSE}
socat <- data.table::fread(input = paste0(pCloud_path, "FACE-IT_data/socat/SOCATv2020.tsv"), skip = 6362, nThread = 10, fill = TRUE) %>%
  dplyr::select(yr, mon, day, `longitude [dec.deg.E]`, `latitude [dec.deg.N]`, `pCO2water_SST_wet [uatm]`)
socat_all <- socat %>% # whole ocean
  dplyr::filter(!is.na(`pCO2water_SST_wet [uatm]`)) # remove NAs
socat_arctic <- dat %>% 
  dplyr::filter(`latitude [dec.deg.N]` > 75, !is.na(`pCO2water_SST_wet [uatm]`))
```

SOCAT v2020 has `r nrow(socat_all)` records of pCO2water_SST_wet [uatm], including `r nrow(socat_arctic)`, or `r 100*nrow(socat_arctic)/nrow(socat_all)`%, in the Arctic Ocean (North of 75°N). According to http://www.physicalgeography.net/fundamentals/8o.html, the surface area of the world ocean and the Arctic Ocean are, respectively, 361,132,000 and 14,056,000 km2. The Arctic Ocean is therefore `r 100  * 14056000 / 361132000`% of the ocean.

```{r read-glodap}
# # gridded data
# GLODAP_depth <- tidync::tidync(paste0(pCloud_path,"FACE-IT_data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.TCO2.nc")) %>% 
#   tidync::activate("D2") %>% 
#   tidync::hyper_tibble() %>% 
#   dplyr::rename(depth = Depth)
# GLODAP_TCO2_grid <- tidync(paste0(pCloud_path,"FACE-IT_data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.TCO2.nc")) %>% 
#   hyper_tibble() %>%
#   dplyr::select(lon, lat, depth_surface, TCO2)
# 
# # Join data to grid
# GLODAP_carb_chem_grid <- GLODAP_TCO2_grid %>% 
#   mutate(lon = ifelse(lon > 180, lon-360, lon)) %>% 
#   left_join(GLODAP_depth, by = c("depth_surface")) %>% 
#   dplyr::filter(!is.na(TCO2))
# 
# # Arctic data
# GLODAP_arctic <- GLODAP_carb_chem_grid %>% 
#     filter(lat > 66)

# The bottle data
GLODAP_bottle <- read_csv(paste0(pCloud_path,"FACE-IT_data/GLODAPv2.2020_Merged_Master_File.csv")) %>%
  dplyr::select(year, month, day, longitude, latitude, bottomdepth, depth, tco2, talk)

glodap_all <- GLODAP_bottle %>% # whole ocean
  dplyr::filter(!is.na(tco2)) # remove NAs
glodap_arctic <- GLODAP_bottle %>% 
  dplyr::filter(latitude > 75, !is.na(tco2))
```

GLODAP v2.2016 has `r nrow(glodap_all)` records of TCO2, including `r nrow(glodap_arctic)`, or `r 100*nrow(glodap_arctic)/nrow(glodap_all)`%, in the Arctic Ocean (North of 75°N). According to http://www.physicalgeography.net/fundamentals/8o.html, the surface area of the world ocean and the Arctic Ocean are, respectively, 361,132,000 and 14,056,000 km2. The Arctic Ocean is therefore `r 100  * 14056000 / 361132000`% of the ocean.

